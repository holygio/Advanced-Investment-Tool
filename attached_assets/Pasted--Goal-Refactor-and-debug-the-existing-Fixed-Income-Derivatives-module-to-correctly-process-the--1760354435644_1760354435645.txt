ðŸŽ¯ Goal

Refactor and debug the existing Fixed Income & Derivatives module to correctly process the offline datasets from
/data/fixedincome/ â€” (yield_curves.csv, credit_spreads.csv, bonds.csv) â€” and eliminate errors such as â€œ-100.00%â€ appearing in KPI cards.

The module must compute all yield, spread, and bond-sensitivity values with correct scaling, consistent units (bps vs decimals), and clear visual logic aligned with fixed-income theory.

ðŸ§  1. Context

The module currently includes 4 sub-tabs:

Yield Curves

Spreads

Bond Sensitivity

Risk-Neutral Demo

Offline CSVs simulate historical data from 2015â€“2024.
All processing and visualization should remain offline (no API calls).

âš™ï¸ 2. Data Sources
/data/fixedincome/yield_curves.csv
Columns: Date, 3M, 2Y, 5Y, 10Y, 30Y
â†’ Used for term structure and term spread.

/data/fixedincome/credit_spreads.csv
Columns: Date, IG_Spread, HY_Spread
â†’ Used for credit risk and risk premia visualization.

/data/fixedincome/bonds.csv
Columns: Bond, Maturity (years), Coupon, Yield, Duration, Convexity
â†’ Used for Î”P/P (price sensitivity) computation.

ðŸ§® 3. Fixes to Implement
âœ… A. Correct Î”P/P Calculation and Scaling

Issue: currently produces impossible values (e.g. âˆ’100%) due to wrong yield-shock scaling.
Fix:

import pandas as pd

def compute_price_change(bonds_df, delta_y_bps=100):
    """
    Compute approximate % price change using duration and convexity.
    Î”P/P â‰ˆ -DÎ”y + 0.5*C*(Î”y)^2
    delta_y_bps: rate shock in basis points (bps)
    """
    delta_y = delta_y_bps / 10000  # convert bps â†’ decimal
    bonds_df['Î”P/P_%'] = (-bonds_df['Duration'] * delta_y + 
                          0.5 * bonds_df['Convexity'] * (delta_y ** 2)) * 100
    return bonds_df


Compute for both +100 bps and âˆ’100 bps to show symmetric sensitivity:

pos_scenario = compute_price_change(bonds.copy(), +100)
neg_scenario = compute_price_change(bonds.copy(), -100)


Add a small validator:

bonds_df['Î”P/P_%'] = bonds_df['Î”P/P_%'].clip(-30, 30)


â†’ prevents unrealistic outputs.

âœ… B. Fix Term and Credit Spread Computations

Ensure spreads use consistent units (bps) and numeric types.

yield_curves['TermSpread_bps'] = (yield_curves['10Y'] - yield_curves['3M']) * 100
credit_spreads['CreditSpread_bps'] = (credit_spreads['HY_Spread'] - credit_spreads['IG_Spread']) * 100


Sanity check:

assert yield_curves['TermSpread_bps'].between(-200, 400).all()
assert credit_spreads['CreditSpread_bps'].between(0, 1000).all()

âœ… C. Improve Yield Curve Evolution Chart

X-axis â†’ maturities (3M, 2Y, 5Y, 10Y, 30Y).

Y-axis â†’ yield (bps or %).

Color â†’ year or date snapshot.

Add hover info showing â€œNormal / Flat / Invertedâ€ shape tag:

slope > 50 bps â†’ Normal

slope between 0 bps and âˆ’25 bps â†’ Flat

slope < âˆ’25 bps â†’ Inverted

âœ… D. Add KPI Cards (Correct Values & Logic)
KPI Card	Formula	Expected Range
Î”P/P (10Y)	from bonds.csv (US10Y, Â±100 bps shock)	âˆ’10% â†’ +10%
Term Spread	
10
ð‘Œ
âˆ’
3
ð‘€
10Yâˆ’3M	âˆ’150 â†’ 300 bps
Credit Spread (HYâ€“IG)	
ð»
ð‘Œ
âˆ’
ð¼
ðº
HYâˆ’IG	100 â†’ 600 bps

Ensure all numeric outputs are formatted as:

"{:+.2f}%".format(value) if percent else "{:.2f} bps"

âœ… E. Enhance Risk-Neutral Demo

Keep the simple binomial tree demo, but correct risk-neutral probability to use decimal yields:

ð‘
ð‘„
=
(
1
+
ð‘Ÿ
)
âˆ’
ð‘‘
ð‘¢
âˆ’
ð‘‘
p
Q
	â€‹

=
uâˆ’d
(1+r)âˆ’d
	â€‹


Add sliders for:

up factor 
ð‘¢
u

down factor 
ð‘‘
d

interest rate 
ð‘Ÿ
r

Show resulting:

risk-neutral probability 
ð‘
ð‘„
p
Q
	â€‹


expected payoff

discounted value

ðŸ–¼ï¸ 4. Frontend Enhancements

Use Plotly for all charts (smoother interactivity).

Add legend toggle and tooltips.

Apply consistent color palette (blue = normal, red = inversion, green = credit).

Cap axes dynamically to avoid empty plots when data has extreme values.

Make KPI cards auto-update when selecting a new date range.

ðŸ“š 5. TheoryCard (Optional)

Add or update the Theory tab text to remind users:

Key Theoretical Concepts

Yield curve shape indicates market expectations (normal, flat, inverted).

Term spreads capture maturity-based risk premia.

Credit spreads measure compensation for default risk.

Bond price sensitivity is driven by duration and convexity.

Under risk-neutral valuation, prices reflect discounted expected payoffs under 
ð‘„
Q.

ðŸ§© 6. Acceptance Criteria
Requirement	Status
No numeric overflow or âˆ’100% bug	âœ… Fixed
Î”P/P scales correctly with 100 bps moves	âœ…
KPI cards show realistic values	âœ…
Term and credit spreads in bps	âœ…
Charts readable and consistent	âœ…
Works fully offline	âœ…
âœ… Final Instruction for Replit AI Agent

Refactor and debug the Fixed Income & Derivatives module using the above guidelines.
Ensure correct scaling, realistic calculations, and consistent units across all tabs.
Fix the Î”P/P calculation to handle 100 bps shocks properly (divide by 10 000).
Verify term and credit spreads are computed in basis points, not raw percentages.
Rebuild KPI card logic so no â€œâˆ’100%â€ or other impossible values appear.
Keep the design fully offline and self-contained, reading from /data/fixedincome/.
Use the updated chart and TheoryCard specifications above to finalize a professional, reliable fixed-income dashboard.