ğŸ¯ Goal

Upgrade the existing Risk module of the Advanced Investments Interactive Lab to a comprehensive real-data analytics lab combining:

Five risk-adjusted performance metrics (Sharpe, Treynor, Information Ratio, Jensenâ€™s Alpha, MÂ²)

Downside risk modeling using Lower Partial Moments (LPM)

Returnâ€“LPM Efficient Frontier, computed directly from the userâ€™s real Yahoo Finance portfolio (10 tickers).

The objective is to unify theory and practice â€” showing how each metric and frontier connects back to the Advanced Investments lecture slides.

ğŸ§  1. Theoretical Foundation (TheoryCard content)
Metric	Formula	Interpretation
Sharpe Ratio	
(
ğ‘Ÿ
ğ‘
âˆ’
ğ‘Ÿ
ğ‘“
)
/
ğœ
ğ‘
(r
p
	â€‹

âˆ’r
f
	â€‹

)/Ïƒ
p
	â€‹

	Excess return per unit of total volatility.
Treynor Ratio	
(
ğ‘Ÿ
ğ‘
âˆ’
ğ‘Ÿ
ğ‘“
)
/
ğ›½
ğ‘
(r
p
	â€‹

âˆ’r
f
	â€‹

)/Î²
p
	â€‹

	Excess return per unit of systematic risk (beta).
Information Ratio	
ğ›¼
ğ‘
/
ğœ
ğœ€
,
ğ‘
Î±
p
	â€‹

/Ïƒ
Îµ,p
	â€‹

	Alpha per unit of idiosyncratic (tracking) error.
Jensenâ€™s Alpha	
ğ‘Ÿ
ğ‘
âˆ’
[
ğ‘Ÿ
ğ‘“
+
ğ›½
ğ‘
(
ğ‘Ÿ
ğ‘š
âˆ’
ğ‘Ÿ
ğ‘“
)
]
r
p
	â€‹

âˆ’[r
f
	â€‹

+Î²
p
	â€‹

(r
m
	â€‹

âˆ’r
f
	â€‹

)]	Portion of return not explained by CAPM (manager skill).
Modiglianiâ€“Modigliani (MÂ²)	
ğ‘Ÿ
ğ‘
,
ğ‘
ğ‘‘
ğ‘—
âˆ’
ğ‘Ÿ
ğ‘š
r
p,adj
	â€‹

âˆ’r
m
	â€‹

	Portfolio return adjusted to have the same volatility as the benchmark (Sharpe ratio in %).
Lower Partial Moment (LPM)	
ğ¸
[
(
min
â¡
(
0
,
ğ‘…
âˆ’
ğœ
)
)
ğ‘›
]
E[(min(0,Râˆ’Ï„))
n
]	Downside risk measure capturing only losses below threshold Ï„.

ğŸ’¡ â€œWhile meanâ€“variance theory treats all volatility as risk, LPM focuses only on downside outcomes, aligning better with investor preferences. The Returnâ€“LPM frontier extends the efficient frontier using this asymmetric risk measure.â€

âš™ï¸ 2. Backend (Python / FastAPI â†’ /backend/risk_world.py)

Use the real Yahoo Finance data already pulled from the portfolio configuration (10 tickers, monthly frequency).

Core Risk & Performance Functions
import numpy as np
import pandas as pd
from scipy.stats import skew, kurtosis, jarque_bera
from scipy.optimize import minimize
import statsmodels.api as sm

def compute_performance_metrics(returns, rf=0.02/12, market_col='SPY'):
    """
    Compute five risk-adjusted performance metrics using real Yahoo Finance data.
    Assumes `returns` DataFrame includes market_col (e.g., SPY).
    """
    mean = returns.mean()
    std = returns.std()
    market = returns[market_col]
    excess_mkt = market - rf
    beta = {}
    alpha = {}
    residual_std = {}

    for col in returns.columns:
        if col == market_col: continue
        y = returns[col] - rf
        X = sm.add_constant(excess_mkt)
        model = sm.OLS(y, X).fit()
        beta[col] = model.params[1]
        alpha[col] = model.params[0]
        residual_std[col] = model.resid.std()

    beta = pd.Series(beta)
    alpha = pd.Series(alpha)
    residual_std = pd.Series(residual_std)

    sharpe = (mean - rf) / std
    treynor = (mean - rf) / beta
    info_ratio = alpha / residual_std
    jensen_alpha = alpha
    market_std = std[market_col]
    m2 = rf + sharpe * market_std  # Sharpe scaled to market volatility

    metrics = pd.DataFrame({
        'Mean': mean,
        'Std': std,
        'Sharpe': sharpe,
        'Treynor': treynor,
        'Info_Ratio': info_ratio,
        'Jensen_Alpha': jensen_alpha,
        'MÂ²': m2,
        'Beta': beta
    }).dropna()

    return metrics.round(4)

LPM & Returnâ€“LPM Frontier (Bawaâ€“Lindenberg)
def lpm(returns, tau=0.0, n=2):
    """Lower Partial Moment below threshold Ï„."""
    diff = np.minimum(0, returns - tau)
    return (np.mean(np.abs(diff)**n))**(1/n)

def compute_lpm_frontier(returns, tau=0.0, n=2):
    """
    Returnâ€“LPM Efficient Frontier using real Yahoo Finance data.
    Replaces variance with LPM(Ï„,n).
    """
    mu = returns.mean().values
    N = len(mu)

    def lpm_obj(w):
        port = returns @ w
        downside = np.minimum(0, port - tau)
        return np.mean(np.abs(downside)**n)

    target_returns = np.linspace(mu.min(), mu.max(), 25)
    results = []
    for mu_target in target_returns:
        cons = [
            {'type': 'eq', 'fun': lambda w: np.sum(w) - 1},
            {'type': 'eq', 'fun': lambda w: w @ mu - mu_target}
        ]
        bounds = [(0, 1)] * N
        w0 = np.ones(N) / N
        opt = minimize(lpm_obj, w0, constraints=cons, bounds=bounds)
        if opt.success:
            results.append({'target_return': mu_target, 'LPM': lpm_obj(opt.x)})
    return pd.DataFrame(results)

ğŸ’» 3. Frontend (Next.js + Tailwind + Plotly â†’ /frontend/app/risk/page.tsx)
Tabs and Views

Tabs:

Overview

LPM & Frontier

Ratios & Performance

Correlations

ğŸŸ¦ Tab 1 â€” Overview

Histogram + KDE overlay (return distribution)

QQ plot + JB test result

Max drawdown visualization

VaR & CVaR shading

ğŸŸ¨ Tab 2 â€” LPM & Frontier

LPM surface (Ï„ Ã— n heatmap)

Semivariance vs Variance scatter

Returnâ€“LPM Frontier (new)

x-axis: LPM(Ï„,n)

y-axis: Expected Return

Overlay Meanâ€“Variance Frontier

Controls:

Ï„ slider: [âˆ’0.02 â†’ 0.02]

n slider: [1 â†’ 3]

Tooltip:

â€œThe Returnâ€“LPM frontier generalizes the efficient frontier using downside risk, better reflecting real investor preferences.â€

ğŸŸ© Tab 3 â€” Ratios & Performance

Interactive bar chart: Sharpe, Treynor, Info Ratio, Jensenâ€™s Î±, MÂ²

Data table (sortable, exportable)

Highlight top performer per metric

Tooltip:

â€œEach measure captures a different dimension of risk-adjusted performance:

Sharpe: total volatility

Treynor: systematic risk

Information: idiosyncratic skill

Jensenâ€™s Î±: CAPM outperformance

MÂ²: Sharpe translated into percentage return.â€

ğŸŸ¥ Tab 4 â€” Correlations

Correlation heatmap (Ï_ij)

Beta vs SPY bar chart

Portfolio risk contribution pie chart

ğŸ“Š 4. API Endpoints

Create endpoints under /api/risk/:

Endpoint	Function
POST /api/risk/metrics	returns 5 performance metrics (Sharpe â†’ MÂ²)
POST /api/risk/lpm	returns LPM grid and Ï„/n surface
POST /api/risk/frontier	returns Returnâ€“LPM frontier data
ğŸ“š 5. TheoryCard Content

Display above the charts:

Portfolio Performance and Risk in Practice

The five classical performance metrics assess efficiency across different risk types:

Sharpe â†’ total risk

Treynor â†’ systematic risk

Information Ratio â†’ idiosyncratic tracking error

Jensenâ€™s Alpha â†’ CAPM excess

MÂ² â†’ Sharpe ratio expressed as % return

In parallel, Lower Partial Moments (LPM) and the Returnâ€“LPM Frontier extend risk measurement to asymmetric losses.

Add ExplainTips on hover:

â€œTreynor isolates market risk via Î².â€

â€œInformation Ratio captures manager-specific alpha efficiency.â€

â€œMÂ² transforms Sharpe into a comparable scale versus the market.â€

â€œLPM penalizes downside only, improving realism when distributions are non-normal.â€

âœ… 6. Acceptance Criteria

âœ… Uses real Yahoo Finance data from the 10-ticker portfolio.

âœ… Computes all 5 metrics (Sharpe, Treynor, Info Ratio, Jensenâ€™s Î±, MÂ²).

âœ… Displays a dynamic Returnâ€“LPM Frontier using real returns.

âœ… Includes Ï„ and n sliders for interactive LPM exploration.

âœ… Adds TheoryCard with formulas and explanations.

âœ… Exports tables and plots to CSV/PNG.

âœ… All charts are interactive and responsive (Plotly.js).

ğŸ§© 7. Final Agent Instruction

Implement this specification into the Risk module of the â€œAdvanced Investments Interactive Lab.â€
Use the existing Yahoo Finance portfolio data (monthly).
Add a new â€œRatios & Performanceâ€ section with the five classical metrics.
Integrate LPM and the Returnâ€“LPM Frontier inside the â€œLPM & Frontierâ€ tab.
Include a TheoryCard explaining formulas and risk concepts.
Ensure all visuals are dynamic, interactive, and exportable.