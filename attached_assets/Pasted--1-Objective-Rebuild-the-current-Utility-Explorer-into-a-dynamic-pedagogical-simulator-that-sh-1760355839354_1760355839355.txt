ğŸ¯ 1 Â· Objective

Rebuild the current Utility Explorer into a dynamic, pedagogical simulator that shows, side-by-side, how preferences (CARA / CRRA / DARA) shape risk attitudes and how these preferences translate into the Stochastic Discount Factor (SDF) used in asset pricing.
The goal is conceptual clarity â€” not empirical fitting â€” so everything must run fully offline with synthetic data.

ğŸ§© 2 Â· Architecture Overview
Layer	Responsibility
Backend (FastAPI / Python)	Generate arrays for 
ğ‘ˆ
(
ğ‘¥
)
U(x), 
ğ‘ˆ
â€²
(
ğ‘¥
)
U
â€²
(x), 
ğ´
(
ğ‘¥
)
A(x), 
ğ‘…
(
ğ‘¥
)
R(x), and SDF paths under user-selected parameters.
Frontend (Next.js / Plotly)	Render 3 interactive dashboards with sliders + explanatory overlays.
Data	Synthetic vectors only; no API calls.
Pages	/theory/utility/ â†’ tabs: Utility & Marginal, Risk Aversion, SDF Explorer.
âš™ï¸ 3 Â· Backend API

Endpoint: /api/theory/utility/generate

Input
{
  "utility": "CRRA" | "CARA" | "DARA",
  "gamma": 3.0,
  "beta": 0.99,
  "wealth_min": 1,
  "wealth_max": 100,
  "sigma_c": 0.02,
  "rho": -0.3,
  "seed": 42
}

Core Formulas
Type	Utility Function 
ğ‘ˆ
(
ğ‘¥
)
U(x)	Marginal 
ğ‘ˆ
â€²
(
ğ‘¥
)
U
â€²
(x)	Notes
CARA	
âˆ’
ğ‘’
âˆ’
ğ‘
ğ‘¥
/
ğ‘
âˆ’e
âˆ’bx
/b	
ğ‘’
âˆ’
ğ‘
ğ‘¥
e
âˆ’bx
	Constant A(x)=b
CRRA	
ğ‘¥
1
âˆ’
ğ›¾
/
(
1
âˆ’
ğ›¾
)
x
1âˆ’Î³
/(1âˆ’Î³)	
ğ‘¥
âˆ’
ğ›¾
x
âˆ’Î³
	Constant R(x)=Î³
DARA	
(
ğ‘
+
ğ‘¥
)
1
âˆ’
ğ›¾
/
(
1
âˆ’
ğ›¾
)
(a+x)
1âˆ’Î³
/(1âˆ’Î³)	
(
ğ‘
+
ğ‘¥
)
âˆ’
ğ›¾
(a+x)
âˆ’Î³
	Both A(x), R(x) â†“ in x

Risk Aversion:

ğ´
(
ğ‘¥
)
=
âˆ’
ğ‘ˆ
â€²
â€²
(
ğ‘¥
)
ğ‘ˆ
â€²
(
ğ‘¥
)
,
ğ‘…
(
ğ‘¥
)
=
ğ‘¥
ğ´
(
ğ‘¥
)
A(x)=âˆ’
U
â€²
(x)
U
â€²â€²
(x)
	â€‹

,R(x)=xA(x)

SDF path:
Simulate 240 months of consumption growth Î”c ~ N(0.002, Ïƒ_c).
Then

ğ‘š
ğ‘¡
=
ğ›½
ğ‘ˆ
â€²
(
ğ‘
ğ‘¡
+
1
)
ğ‘ˆ
â€²
(
ğ‘
ğ‘¡
)
m
t
	â€‹

=Î²
U
â€²
(c
t
	â€‹

)
U
â€²
(c
t+1
	â€‹

)
	â€‹


Normalize 
ğ¸
[
ğ‘š
ğ‘¡
]
=
1
E[m
t
	â€‹

]=1.
Also compute CAPM linear SDF:

ğ‘š
ğ‘¡
ğ¶
ğ´
ğ‘ƒ
ğ‘€
=
ğ‘
âˆ’
ğ‘
ğ‘…
ğ‘š
,
ğ‘¡
m
t
CAPM
	â€‹

=aâˆ’bR
m,t
	â€‹


with 
ğ‘…
ğ‘š
âˆ¼
ğ‘
(
0.005
,
0.04
)
R
m
	â€‹

âˆ¼N(0.005,0.04) and 
ğœŒ
(
ğ‘…
ğ‘š
,
Î”
ğ‘
)
=
ğœŒ
Ï(R
m
	â€‹

,Î”c)=Ï.

Output

JSON object containing:

{
  "U": [...],
  "Uprime": [...],
  "A": [...],
  "R": [...],
  "SDF_utility": [...],
  "SDF_capm": [...],
  "pricing_errors": [...]
}

ğŸ¨ 4 Â· Frontend Implementation
ğŸ”¹ Tab 1 â€” Utility & Marginal Utility

Plot both 
ğ‘ˆ
(
ğ‘¥
)
U(x) and 
ğ‘ˆ
â€²
(
ğ‘¥
)
U
â€²
(x) on dual axes.

Sliders: Î³ (0â€“10), wealth range (0â€“100), utility type.

Shade region where marginal utility falls fastest (â€œDiminishing returns to wealthâ€).

Tooltip: display current 
ğ‘¥
,
ğ‘ˆ
,
ğ‘ˆ
â€²
,
ğ‘€
ğ‘ˆ
_
ğ‘Ÿ
ğ‘
ğ‘¡
ğ‘–
ğ‘œ
=
ğ‘ˆ
â€²
/
ğ‘ˆ
x,U,U
â€²
,MU_ratio=U
â€²
/U.

Add theory caption: â€œCurvature of U(x) determines aversion to risk.â€

ğŸ”¹ Tab 2 â€” Risk Aversion Visualizer

Plot A(x) (left y-axis) and R(x) (right y-axis).

Overlay all three utility types (toggle checkbox).

Annotate:

Flat A(x) = CARA

Constant R(x) = CRRA

Both declining = DARA

Dynamic labels show numeric values for 
ğ´
(
10
)
A(10), 
ğ‘…
(
10
)
R(10).

Add â€œInterpretation Cardâ€ under plot:

Absolute RA measures fear per $1 loss; Relative RA measures fear relative to wealth.

ğŸ”¹ Tab 3 â€” SDF Explorer

Show how risk aversion and consumption volatility affect discounting.

Elements:

Line 1: Utility-based SDF path.

Line 2: Linear CAPM SDF (affine).

Shade â€œRecession Regionâ€ (Î”c < 0).

Sliders:

Ïƒ_c (consumption volatility)

Ï (consumptionâ€“market correlation)

Î³ (risk aversion)

KPI cards:

Mean SDF

Std SDF

Pricing error 
1
âˆ’
ğ¸
[
ğ‘š
ğ‘…
]
1âˆ’E[mR]

Add interactive â€œFreeze stateâ€ cursor â†’ shows implied asset price for that state.

Tooltip text:
â€œHigher m â‡’ expensive state; assets paying here require lower expected return.â€

ğŸ§® 5 Â· Advanced Add-Ons (Optional if time permits)
Feature	Purpose
State-Price Heatmap	2-D map of 
ğ‘š
ğ‘¡
m
t
	â€‹

 vs consumption growth & R_m).
Î²-pricing panel	Show 
ğ¸
[
ğ‘…
ğ‘–
]
âˆ’
ğ‘Ÿ
ğ‘“
=
âˆ’
ğ¶
ğ‘œ
ğ‘£
(
ğ‘…
ğ‘–
,
ğ‘š
)
/
ğ‘‰
ğ‘
ğ‘Ÿ
(
ğ‘š
)
E[R
i
	â€‹

]âˆ’r
f
	â€‹

=âˆ’Cov(R
i
	â€‹

,m)/Var(m) live, linking SDF to CAPM.
Toggle for log-utility	
ğ‘ˆ
(
ğ‘¥
)
=
ln
â¡
(
ğ‘¥
)
U(x)=ln(x) as special case Î³=1.
ğŸ§­ 6 Â· Theory Cards (Text Blocks)

Utility & Marginal:

Utility quantifies satisfaction from wealth. The steeper its curvature, the faster marginal utility declines â€” and the stronger the aversion to risk.

Risk Aversion:

CARA implies a fixed fear of loss, CRRA assumes risk aversion is proportional to wealth, and DARA suggests investors grow bolder as they become richer.

SDF Explorer:

The SDF translates future payoffs into present value.
Under utility theory 
ğ‘š
ğ‘¡
=
ğ›½
ğ‘ˆ
â€²
(
ğ‘
ğ‘¡
+
1
)
/
ğ‘ˆ
â€²
(
ğ‘
ğ‘¡
)
m
t
	â€‹

=Î²U
â€²
(c
t+1
	â€‹

)/U
â€²
(c
t
	â€‹

).
Under CAPM itâ€™s linear: 
ğ‘š
ğ‘¡
=
ğ‘
âˆ’
ğ‘
ğ‘…
ğ‘š
m
t
	â€‹

=aâˆ’bR
m
	â€‹

.
Both imply assets that pay off in recessions are more valuable and earn lower expected returns.

âœ… 7 Â· Acceptance Checklist
Criterion	Result
Plots react smoothly to Î³, Ïƒ_c, Ï	âœ…
Marginal utility declines visibly	âœ…
Risk aversion curves behave per theory	âœ…
Utility-based and CAPM SDF both displayed	âœ…
Recession region shaded correctly	âœ…
Works offline (Deterministic seed)	âœ…
ğŸ“„ 8 Â· Final Instruction for Replit AI Agent

Implement this Utility & SDF module upgrade exactly as specified.

Refactor backend to generate synthetic data via the given formulas.

Redesign frontend tabs with comparative and annotated Plotly charts.

Add sliders for Î³, Ïƒ_c, Ï, and utility type.

Integrate the CAPM Î²-pricing relation in the Theory tab for completeness.

Ensure plots are responsive, color-coded, and intuitive for teaching risk aversion and discounting.