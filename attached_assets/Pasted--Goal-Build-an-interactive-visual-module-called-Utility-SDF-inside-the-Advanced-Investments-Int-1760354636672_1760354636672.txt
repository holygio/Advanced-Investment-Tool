ğŸ¯ Goal

Build an interactive visual module called Utility & SDF inside the Advanced Investments Interactive Lab that allows users to see, manipulate, and compare different utility functions (CARA, CRRA, DARA) and the corresponding Stochastic Discount Factors (SDFs) â€” both in shape and economic meaning â€” without relying on any real or simulated data.

The focus is purely conceptual and visual:

how the utility curve 
ğ‘ˆ
(
ğ‘¥
)
U(x) changes with risk aversion;

how the marginal utility 
ğ‘ˆ
â€²
(
ğ‘¥
)
U
â€²
(x) behaves;

how the SDF 
ğ‘š
=
ğ›½
ğ‘ˆ
â€²
(
ğ‘
ğ‘¡
+
1
)
/
ğ‘ˆ
â€²
(
ğ‘
ğ‘¡
)
m=Î²U
â€²
(c
t+1
	â€‹

)/U
â€²
(c
t
	â€‹

) transforms across CARA/CRRA/DARA;

and how a linear CAPM-style SDF compares to these theoretical ones.

ğŸ§  1. Conceptual Scope

This module visualizes four interconnected concepts from your lecture:

Concept	Mathematical Representation	Visual Focus
Utility Function	
ğ‘ˆ
(
ğ‘¥
)
U(x)	Shape curvature and concavity
Marginal Utility	
ğ‘ˆ
â€²
(
ğ‘¥
)
U
â€²
(x)	Declining slope with x (risk aversion)
Absolute & Relative Risk Aversion	
ğ´
(
ğ‘¥
)
=
âˆ’
ğ‘ˆ
â€²
â€²
(
ğ‘¥
)
/
ğ‘ˆ
â€²
(
ğ‘¥
)
A(x)=âˆ’U
â€²â€²
(x)/U
â€²
(x), 
ğ‘…
(
ğ‘¥
)
=
âˆ’
ğ‘¥
ğ‘ˆ
â€²
â€²
(
ğ‘¥
)
/
ğ‘ˆ
â€²
(
ğ‘¥
)
R(x)=âˆ’xU
â€²â€²
(x)/U
â€²
(x)	How aversion changes with wealth
Stochastic Discount Factor (SDF)	
ğ‘š
=
ğ›½
ğ‘ˆ
â€²
(
ğ‘
ğ‘¡
+
1
)
/
ğ‘ˆ
â€²
(
ğ‘
ğ‘¡
)
m=Î²U
â€²
(c
t+1
	â€‹

)/U
â€²
(c
t
	â€‹

)	How utility translates into pricing weights

No data is needed â€” all curves are generated from equations and sliders.

ğŸ§© 2. Backend (Python / FastAPI â†’ /backend/utility_world.py)

Generate theoretical curves dynamically using numpy arrays over a wealth or consumption grid.

import numpy as np
import pandas as pd

def utility_curves(x, gamma=3, b=0.001):
    """Compute U(x), U'(x), A(x), R(x) for CARA, CRRA, DARA"""
    curves = {}
    # CRRA
    U_crra = (x**(1-gamma) - 1) / (1 - gamma) if gamma != 1 else np.log(x)
    Uprime_crra = x**(-gamma)
    A_crra = gamma / x
    R_crra = gamma

    # CARA
    U_cara = -np.exp(-b*x)
    Uprime_cara = b*np.exp(-b*x)
    A_cara = b * np.ones_like(x)
    R_cara = b*x

    # DARA (custom logarithmic form)
    U_dara = np.log(x) - 0.5*np.log(1 + np.log(x)**2)
    Uprime_dara = 1/(x*(1 + (np.log(x))**2))
    A_dara = 1/(x*np.log(x+1))
    R_dara = np.log(x)/(1 + np.log(x)**2)

    curves['CRRA'] = {'U': U_crra, 'Uprime': Uprime_crra, 'A': A_crra, 'R': R_crra}
    curves['CARA'] = {'U': U_cara, 'Uprime': Uprime_cara, 'A': A_cara, 'R': R_cara}
    curves['DARA'] = {'U': U_dara, 'Uprime': Uprime_dara, 'A': A_dara, 'R': R_dara}

    return pd.DataFrame({'x': x}), curves

def sdf_from_utility(gamma=3, b=0.001, beta=0.99, cons_growth=np.linspace(-0.05,0.05,100)):
    """Compute SDF paths for CARA and CRRA given consumption growth grid"""
    sdf = {}
    g = 1 + cons_growth
    sdf['CRRA'] = beta * g**(-gamma)
    sdf['CARA'] = beta * np.exp(-b*(g-1))
    sdf['CAPM'] = 1 - 3*cons_growth  # linearized SDF (affine in Rm)
    return pd.DataFrame({'Î”c': cons_growth, 'm_CRRA': sdf['CRRA'], 'm_CARA': sdf['CARA'], 'm_CAPM': sdf['CAPM']})

ğŸ’» 3. Frontend (Next.js + Tailwind + Plotly â†’ /frontend/app/utility/page.tsx)

Structure into three interactive panels.

ğŸŸ¦ Panel 1 â€” â€œUtility and Marginal Utilityâ€

Layout:

Left: radio buttons â†’ CARA / CRRA / DARA

Slider â†’ Risk aversion parameter (Î³ for CRRA, b for CARA)

Chart 1: 
ğ‘ˆ
(
ğ‘¥
)
U(x) curve

Chart 2: 
ğ‘ˆ
â€²
(
ğ‘¥
)
U
â€²
(x) curve

ExplainTips:

â€œConcavity of U(x) indicates risk aversion.â€

â€œSteeper decline in Uâ€²(x) means stronger aversion.â€

â€œCARA has constant absolute aversion; CRRA constant relative; DARA decreasing absolute aversion.â€

Dynamic Display:
As Î³ or b changes, both plots update instantly, letting the user see curvature tighten or flatten.

ğŸŸ¨ Panel 2 â€” â€œRisk Aversion and Dominanceâ€

Charts:

Absolute Risk Aversion: 
ğ´
(
ğ‘¥
)
=
âˆ’
ğ‘ˆ
â€²
â€²
(
ğ‘¥
)
/
ğ‘ˆ
â€²
(
ğ‘¥
)
A(x)=âˆ’U
â€²â€²
(x)/U
â€²
(x)

Relative Risk Aversion: 
ğ‘…
(
ğ‘¥
)
=
âˆ’
ğ‘¥
ğ‘ˆ
â€²
â€²
(
ğ‘¥
)
/
ğ‘ˆ
â€²
(
ğ‘¥
)
R(x)=âˆ’xU
â€²â€²
(x)/U
â€²
(x)

ExplainTips:

â€œCARA: flat line â†’ constant absolute aversion.â€

â€œCRRA: R(x) = Î³ (constant relative aversion).â€

â€œDARA: both A(x) and R(x) decline with x â†’ wealth reduces risk aversion.â€

â€œSSD implies decreasing Uâ€²(x), while TSD adds preference for positive skew (convex Uâ€²â€²â€²(x)).â€

Add a small schematic diagram of FSD, SSD, TSD hierarchy on the side (static SVG).

ğŸŸ¥ Panel 3 â€” â€œStochastic Discount Factor (SDF) Explorerâ€

Core Plot:

ğ‘š
(
Î”
ğ‘
)
m(Î”c) curves for CARA, CRRA, CAPM
(x-axis = consumption growth or market return Î”c, y-axis = m)

Slider: risk aversion Î³ (CRRA) or b (CARA)

Switch: â€œShow CAPM SDFâ€ toggle

Visual logic:

All SDF curves slope downward (risk-averse).

CRRA: convex in Î”c â†’ stronger aversion to downturns.

CARA: exponential slope â†’ constant sensitivity.

CAPM: linear (affine) version: 
ğ‘š
=
ğ‘
+
ğ‘
ğ‘…
ğ‘š
m=a+bR
m
	â€‹

.

ExplainTips:

â€œSDF transforms payoffs into present values.â€

â€œSteeper negative slope â†’ higher risk aversion.â€

â€œWhen SDF turns negative, model violates non-satiation.â€

â€œCAPM assumes linear SDF; CRRA and CARA yield non-linear ones.â€

Annotations:

Highlight â€œrecession regionâ€ (Î”c < 0) with shaded area where SDF rises above 1 â€” assets paying here are valuable hedges.

ğŸ“š 4. TheoryCard Content

Utility, Risk Aversion, and the Stochastic Discount Factor

The shape of 
ğ‘ˆ
(
ğ‘¥
)
U(x) defines investor preferences: concavity â†’ risk aversion.

ğ‘ˆ
â€²
(
ğ‘¥
)
U
â€²
(x) decreases with wealth â†’ diminishing marginal utility.

Risk aversion can be:

CARA: constant absolute

CRRA: constant relative

DARA: decreasing absolute

The SDF connects utility to asset pricing:

ğ‘š
ğ‘¡
+
1
=
ğ›½
ğ‘ˆ
â€²
(
ğ‘
ğ‘¡
+
1
)
ğ‘ˆ
â€²
(
ğ‘
ğ‘¡
)
m
t+1
	â€‹

=Î²
U
â€²
(c
t
	â€‹

)
U
â€²
(c
t+1
	â€‹

)
	â€‹

.

CAPMâ€™s linear SDF 
ğ‘š
=
ğ‘
+
ğ‘
ğ‘…
ğ‘€
m=a+bR
M
	â€‹

 is a special, simplified case of CRRA.

Stochastic dominance (FSD â†’ SSD â†’ TSD) links back to SDF curvature â€” positive slope violations indicate irrational preferences.

Include collapsible â€œMath Viewâ€ tab showing all formulas in LaTeX-rendered form.

âš™ï¸ 5. Interactivity Logic
Control	Effect
Î³ Slider	Updates curvature for CRRA and SDF slope
b Slider	Updates CARA curvature
Checkbox â€œShow CAPM SDFâ€	Toggles linear reference line
Dropdown â€œUtility Typeâ€	Switches all active curves
Toggle â€œShow Risk Aversion Functionsâ€	Adds/removes A(x), R(x) plots
Export	CSV and PNG of current chart
âœ… 6. Acceptance Criteria

âœ… No data loading required â€” all curves computed analytically.

âœ… Users can switch between CARA, CRRA, DARA and see changes in U(x), Uâ€²(x), A(x), R(x), and SDF.

âœ… The SDF panel shows both utility-based (nonlinear) and CAPM (linear) SDFs.

âœ… Each plot has contextual â€œExplainTipâ€ popups linked to theory.

âœ… Includes TheoryCard with formulas, conditions, and interpretations.

âœ… Everything functions offline and instantly.

ğŸ§© 7. Final Instruction for Replit AI Agent

Implement a full Utility & SDF Visual Simulator inside the Advanced Investments Lab.

The module must visually show:

Three utility classes (CARA, CRRA, DARA);

Corresponding marginal utilities and risk aversion measures;

Stochastic Discount Factors derived from utility (plus CAPM linear SDF).

No real or synthetic datasets are needed â€” all functions are generated mathematically.
Ensure the experience is educational: include dynamic sliders, clear tooltips, and a TheoryCard summarizing all formulas, assumptions, and economic intuition.

This module should make risk aversion and SDF concepts visually intuitive, bridging microeconomic preferences and asset pricing foundations.